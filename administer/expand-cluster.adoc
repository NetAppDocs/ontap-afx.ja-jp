---
sidebar: sidebar 
permalink: administer/expand-cluster.html 
keywords: afx, afx system, expansion, cluster expansion, expand cluster, add nodes 
summary: ストレージ容量とは独立して、AFX クラスターのコンピューティング容量を拡張できます。拡張は中断なく実行され、ボリュームがノード間で再バランス調整されるため、パフォーマンスが直線的に向上します。この機能は、AFX ユーザーの継続的なニーズに合わせて調整する際に大きなメリットとなります。 
---
= AFXストレージシステムクラスターを拡張する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ストレージ容量とは独立して、AFX クラスターのコンピューティング容量を拡張できます。拡張は中断なく実行され、ボリュームがノード間で再バランス調整されるため、パフォーマンスが直線的に向上します。この機能は、AFX システム ユーザーの継続的なニーズに合わせて調整する際に大きなメリットとなります。



== クラスターの拡張の準備

AFX クラスターを拡張する前に、基本的な要件とトラブルシューティングの一般的なアプローチを理解しておく必要があります。



=== 要件

クラスタ管理者アカウントの認証情報が必要であり、SSH を使用してONTAP CLI に接続できる必要があります。クラスターを拡張する場合は、偶数個のノードを追加し、リリースに基づいて AFX システムのサイズ制限に従う必要があります。



=== トラブルシューティング

クラスターの拡張を実行する際には、知っておくべき概念とトラブルシューティングのシナリオがいくつかあります。



==== 自動ボリューム再調整

自動トポロジ管理 (ATM) は、割り当ての不均衡を検出し、クラスター ノード間でボリュームのバランスを再調整する内部 AFX システム コンポーネントです。これは、データをコピーするのではなく、メタデータの更新を使用してボリュームを再配置するために、Zero Copy Volume Move (ZCVM) テクノロジに依存しています。  ZCVM は、AFX ストレージ システムで使用できるデフォルトのボリューム移動テクノロジーです。



==== 考えられるトラブルシューティングのシナリオ

AFX クラスターの拡張に関連するボリュームの移動中に調査する必要があるシナリオがいくつかあります。

ATMによって取引量は移動されていない:: これは、クラスターがすでにバランスが取れている場合、または移動するのに適したボリュームがない場合に発生する可能性があります。
ATM をいつ、どのように稼働させるべきかについての混乱:: ボリュームが予想どおりに速く配布されないように見える場合があります。 ATM は 5 分ごとにハードウェア イベントを検出して応答しようとします。最悪の場合、最後のリバランス操作が完了してから 40 分後にリバランス操作が開始されます。




==== CLIコマンドを使用します。

クラスタ拡張操作を監視するために使用できるコマンドがいくつかあります。

* `volume move show`
* `volume move show -instance`


必要に応じて、 NetAppサポートに連絡して追加のサポートを受ける必要があります。



== ノードを追加してクラスターを拡張する

この手順では、既存のクラスターにノードのペアを追加する方法について説明します。この手順は、他のデプロイメント環境にも適応できます。  ONTAP CLI と System Manager 管理インターフェイスの両方を使用する必要があります。

.手順
. ONTAP CLI に接続し、高度な権限レベルを設定します。
+
`afx> set advanced`

. 現在のノードのボリュームの場所を表示します。ノードあたりのボリュームの数に注意してください。
+
`afx> vol show -fields node,size,constituent-count -is-constituent true -node *`

. クラスタ相互接続 IP アドレスを表示し、後の手順で使用するために保存します。
+
`afx> net int show -role cluster`

. クラスターに追加する各ノードのサービス プロセッサにログインします。
. プロンプトから「*system console*」と入力して、ノードのコンソールにアクセスします。
. ノードを起動してブート メニュー プロンプトを表示します。
+
`LOADER> boot_ontap menu`

+
メニューが読み込まれない場合は、*Ctrl+C* キーを押してブート メニューにアクセスします。

. 必要に応じてメニューからブート オプションの 1 つを選択します。プロンプトが表示されたら、「*yes*」と入力して続行します。
+
ここから LOADER に戻された場合は、LOADER プロンプトで *boot_ontap* と入力します。

. クラスタ セットアップ ウィザードを使用して、ノード管理 LIF、サブネット、およびゲートウェイを構成します。
+
この構成は、System Manager によってクラスタに追加するノードを検出するために使用されます。ポート、IP アドレス、ネットマスク、デフォルト ゲートウェイなどの値をプロンプトに従って入力します。

. CLI にアクセスするには、*CTL+C* を押します。
. クラスタ相互接続アドレスを変更して、ネットワーク内でルーティングできるようにします。環境に適した構成を使用します。
+
`afx> net int show -role cluster`

+
`afx> net int modify -vserver Cluster -lif clus1 -address 192.168.100.201`

+
`afx> net int modify -vserver Cluster -lif clus2 -address 192.168.100.202`

+
この手順は、他のインターフェイスがONTAPによって自動的に作成される 169.254.xx アドレスを使用しない場合にのみ必要です。

. 他の AFX ノード コントローラーでも上記の手順を繰り返します。
. クラスタ管理 IP アドレスを使用してシステム マネージャにアクセスします。
. システム マネージャーで、*クラスター* を選択し、次に *概要* を選択し、*ノード* タブを選択します。
. 「*このクラスターの一部ではありません*」セクションを見つけて選択してくださいimage:icon_add_blue_bg.png["プラス記号と白い文字で「add」という単語が続く青い四角形"]。
+
** クラスター相互接続 IP アドレスが変更される前にノードが検出された場合は、ウィンドウを終了して戻ってノードを再度検出する必要があります。
** オプションとして、System Managerの代わりにCLIを使用してノードを追加することもできます。コマンドを参照してください。 `cluster add-node` 。


. *ノードの追加* メニューで構成の詳細を指定します。管理 IP アドレスは手動で追加することも、サブネットを使用して追加することもできます。
. ONTAP CLI に接続して、ノード追加操作のステータスを監視します。
+
`afx> add-node-status`

. 操作が完了したら、すべてのノードにわたってボリュームの配置を確認します。適切なノード名を使用して、各ノードに対してコマンドを 1 回発行します。
+
`afx> set advanced`

+
`afx> vol show -fields node,size,constituent-count -is-constituent true -node NODE_NAME`



.結果
* クラスターに新しいノードを追加しても中断はありません。
* ボリュームの移動は自動的に行われるはずです。
* パフォーマンスは直線的に増加します。




== 関連情報

* link:../get-started/prepare-cluster-admin.html["AFX システムの管理を準備する"]
* link:../faq-ontap-afx.html["ONTAP AFX ストレージ システムに関する FAQ"]
* https://mysupport.netapp.com/["NetAppサポート サイト"^]

