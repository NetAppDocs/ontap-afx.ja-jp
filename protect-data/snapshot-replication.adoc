---
sidebar: sidebar 
permalink: protect-data/snapshot-replication.html 
keywords: afx, afx system, manage replication, manage snapshot replication 
summary: スナップショット レプリケーションは、AFX システム上の整合性グループを地理的に離れた場所にコピーするプロセスです。最初のレプリケーションの後、整合性グループへの変更は、レプリケーション ポリシーに基づいてリモート ロケーションにコピーされます。複製された整合性グループは、災害復旧やデータ移行に使用できます。 
---
= AFX ストレージ システムでのスナップショット レプリケーションの管理
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
スナップショット レプリケーションは、AFX システム上の整合性グループを地理的に離れた場所にコピーするプロセスです。最初のレプリケーションの後、整合性グループへの変更は、レプリケーション ポリシーに基づいてリモート ロケーションにコピーされます。複製された整合性グループは、災害復旧やデータ移行に使用できます。

スナップショット レプリケーションを設定するには、AFX ストレージ システムとリモート ロケーションの間にレプリケーション関係を確立する必要があります。レプリケーション関係はレプリケーション ポリシーによって管理されます。すべてのスナップショットを複製するデフォルトのポリシーは、クラスターのセットアップ中に作成されます。デフォルトのポリシーを使用することも、オプションで新しいポリシーを作成することもできます。



== ステップ1: クラスタピア関係を作成する

データをリモート クラスターに複製して保護する前に、ローカル クラスターとリモート クラスターの間にクラスター ピア関係を作成する必要があります。

.開始する前に
クラスタ ピアリングの前提条件は、AFX システムでも他のONTAPシステムと同じです。link:https://docs.netapp.com/us-en/ontap/peering/prerequisites-cluster-peering-reference.html["クラスタピアリングの前提条件を確認する"^] 。

.手順
. ローカル クラスタの System Manager で、*クラスタ > 設定* を選択します。
. *クラスタ間設定*の*クラスタピア*の横にあるimage:icon_kabob.gif["3つの縦の青い点"]をクリックし、[*クラスター ピアの追加*] を選択します。
. *リモート クラスターの起動* を選択します。これにより、リモート クラスターでの認証に使用するパスフレーズが生成されます。
. リモート クラスターのパスフレーズが生成されたら、それをローカル クラスターの *Passphrase* の下に貼り付けます。
. 選択image:icon_add.gif["青いプラス記号の後に青い文字で「add」という単語が続く"]; 次に、クラスタ間ネットワーク インターフェイスの IP アドレスを入力します。
. *クラスター ピアリングの開始*を選択します。


.次の手順
ローカル AFX クラスターをリモート クラスターとピアリングしました。レプリケーション関係を作成できるようになりました。



== ステップ2: 必要に応じてレプリケーションポリシーを作成する

スナップショット レプリケーション ポリシーは、AFX クラスターで実行された更新がリモート サイトにいつレプリケートされるかを定義します。

.手順
. System Manager で、*保護 > ポリシー* を選択し、*レプリケーション ポリシー* を選択します。
. 選択image:icon_add_blue_bg.png["プラス記号と白い文字で「add」という単語が続く青い四角形"]。
. レプリケーション ポリシーの名前を入力するか、デフォルト名を受け入れて、説明を入力します。
. *ポリシー スコープ* を選択します。
+
レプリケーション ポリシーをクラスター全体に適用する場合は、*クラスター* を選択します。レプリケーション ポリシーを特定のストレージ VM 内のボリュームにのみ適用する場合は、*ストレージ VM* を選択します。

. *ポリシータイプ*を選択します。
+
[cols="2,6a"]
|===
| オプション | 手順 


| データがソースに書き込まれた後、リモート サイトにコピーします。  a| 
.. *非同期*を選択します。
.. *ソースからスナップショットを転送*の下で、デフォルトの転送スケジュールを受け入れるか、別のスケジュールを選択します。
.. すべてのスナップショットを転送するか、転送するスナップショットを決定するルールを作成するかを選択します。
.. 必要に応じて、ネットワーク圧縮を有効にします。




| ソース サイトとリモート サイトに同時にデータを書き込みます。  a| 
.. *同期*を選択します。


|===
. *保存*を選択します。


.次の手順
レプリケーション ポリシーが作成され、AFX システムとリモート ロケーション間のレプリケーション関係を作成する準備が整いました。



== ステップ3: レプリケーション関係を作成する

スナップショット レプリケーション関係により、AFX システムとリモート ロケーション間の接続が確立され、整合性グループをリモート クラスターにレプリケートできるようになります。複製された整合性グループは、災害復旧やデータ移行に使用できます。

ランサムウェア攻撃から保護するために、レプリケーション関係を設定するときに、宛先スナップショットをロックすることを選択できます。ロックされたスナップショットは、誤ってまたは悪意を持って削除されることはありません。ボリュームがランサムウェア攻撃によって侵害された場合、ロックされたスナップショットを使用してデータを回復できます。

.開始する前に
保存先のスナップショットをロックしたい場合は、link:../secure-data/ransomware-protection.html#initialize-the-snaplock-compliance-clock["スナップショットコンプライアンスクロックを初期化する"]レプリケーション関係を作成する前に。

ロックされた宛先スナップショットの有無にかかわらず、レプリケーション関係を作成します。

[role="tabbed-block"]
====
.ロックされたスナップショット
--
.手順
. System Manager で、*保護 > 整合性グループ* を選択します。
. 整合性グループを選択します。
. 選択image:icon_kabob.gif["3つの縦の青い点"]; 次に、[保護] を選択します。
. *リモート保護*の下で、*リモート クラスターにレプリケート*を選択します。
. *レプリケーション ポリシー*を選択します。
+
_vault_ レプリケーション ポリシーを選択する必要があります。

. *宛先設定*を選択します。
. *削除を防ぐために宛先スナップショットをロックする*を選択します
. 最大および最小のデータ保持期間を入力します。
. データ転送の開始を遅らせるには、[すぐに転送を開始] の選択を解除します。
+
デフォルトでは、初期データ転送がすぐに開始されます。

. オプションで、デフォルトの転送スケジュールを上書きするには、[*宛先設定*] を選択し、[*転送スケジュールの上書き*] を選択します。
+
転送スケジュールをサポートするには、最低 30 分にする必要があります。

. *保存*を選択します。


--
.ロックされたスナップショットなし
--
.手順
. システム マネージャーで、*保護 > レプリケーション* を選択します。
. ローカル宛先またはローカルソースとのレプリケーション関係を作成する場合に選択します。
+
[cols="2,2"]
|===
| オプション | 手順 


| 地元の目的地  a| 
.. *ローカル目的地*を選択し、image:icon_replicate_blue_bg.png["青い背景に白い文字で「replicate」と書かれた長方形"] 。
.. ソース整合性グループを検索して選択します。
+
_source_ 整合性グループは、複製するローカル クラスター上の整合性グループを指します。





| 地元の情報源  a| 
.. *ローカルソース*を選択し、image:icon_replicate_blue_bg.png["青い背景に白い文字で「replicate」と書かれた長方形"] 。
.. ソース整合性グループを検索して選択します。
+
_source_ 整合性グループは、複製するローカル クラスター上の整合性グループを指します。

.. *レプリケーション先* で、レプリケート先のクラスターを選択し、ストレージ VM を選択します。


|===
. レプリケーション ポリシーを選択します。
. データ転送の開始を遅らせるには、[*宛先設定*] を選択し、[*すぐに転送を開始*] の選択を解除します。
+
デフォルトでは、初期データ転送がすぐに開始されます。

. オプションで、デフォルトの転送スケジュールを上書きするには、[*宛先設定*] を選択し、[*転送スケジュールの上書き*] を選択します。
+
転送スケジュールをサポートするには、最低 30 分にする必要があります。

. *保存*を選択します。


--
====
.次の手順
レプリケーション ポリシーと関係を作成したので、レプリケーション ポリシーで定義されたとおりに初期データ転送が開始されます。オプションでレプリケーション フェールオーバーをテストして、AFX システムがオフラインになった場合にフェールオーバーが正常に実行されることを確認できます。



== ステップ4: レプリケーションフェイルオーバーをテストする

オプションで、ソース クラスターがオフラインの場合に、リモート クラスター上の複製されたボリュームからデータを正常に提供できることを検証します。

.手順
. システム マネージャーで、*保護 > レプリケーション* を選択します。
. テストしたいレプリケーション関係にマウスを移動し、image:icon_kabob.gif["3つの縦の青い点"] 。
. *フェイルオーバーのテスト*を選択します。
. フェイルオーバー情報を入力し、*フェイルオーバーのテスト*を選択します。


.次の手順
災害復旧のためのスナップショットレプリケーションでデータが保護されたので、link:../secure-data/encrypt-data-at-rest.html["保存データを暗号化する"] AFX システム内のディスクが再利用、返却、紛失、盗難された場合でも、ディスクを読み取ることはできません。
